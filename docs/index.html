<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366F1">
    <title>Wedding Elite V2.0 | ×”××¤×œ×™×§×¦×™×” ×œ× ×™×”×•×œ ×—×ª×•× ×•×ª</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Assistant', sans-serif;
            background: #F8FAFC;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            user-select: none;
        }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid #F1F5F9;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
        }
        
        .editable {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .editable:hover {
            background: #F1F5F9;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
        }
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #6366F1;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="toast" class="toast">
        <div class="flex items-center gap-3">
            <span id="toast-icon" class="text-2xl">âœ…</span>
            <p id="toast-message" class="font-bold text-slate-800"></p>
        </div>
    </div>

    <div id="modal" class="modal" onclick="closeModal()">
        <div class="bg-white rounded-3xl p-6 max-w-md w-full mx-4" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-xl font-bold mb-4"></h3>
            <div id="modal-content"></div>
        </div>
    </div>

    <div class="pb-20">
        
        <div id="tab-home" class="tab-content active">
            <div class="bg-white p-6 flex items-center justify-between sticky top-0 z-10 shadow-sm">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">
                        ×©×œ×•× <span id="display-names" class="text-indigo-600">...</span>! ğŸ’•
                    </h1>
                </div>
                <button onclick="loadDashboard()" class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-xl">ğŸ”„</button>
            </div>

            <div class="p-4 space-y-4">
                <div class="card p-8 text-center bg-gradient-to-br from-indigo-600 to-purple-600 text-white">
                    <p class="text-indigo-200 text-sm font-bold uppercase mb-2">×”×¡×¤×™×¨×” ×œ××—×•×¨!</p>
                    <h2 id="days-left" class="text-6xl font-black my-4">--</h2>
                    <p class="text-lg">×™××™× ×œ×—×ª×•× ×”</p>
                    <p id="display-date" class="text-white/90 mt-4">ğŸ“… ...</p>
                </div>

                <div class="card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-slate-800">×”××¦×‘ ×©×œ×›× ×”×™×•×</h3>
                        <span class="text-3xl">ğŸ˜Œ</span>
                    </div>
                    <div class="grid grid-cols-3 gap-3 text-center">
                        <div>
                            <p class="text-2xl font-bold text-green-600" id="tasks-done-count">0</p>
                            <p class="text-xs text-slate-500">×”×•×©×œ××•</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-orange-500" id="tasks-urgent-count">0</p>
                            <p class="text-xs text-slate-500">×“×—×•×¤×•×ª</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-indigo-600" id="budget-spent-display">â‚ª0</p>
                            <p class="text-xs text-slate-500">×”×•×¦×</p>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-slate-800">âš¡ ××©×™××•×ª ×¤×ª×•×—×•×ª</h3>
                        <button onclick="switchTab('tasks')" class="text-indigo-600 text-sm font-bold">×œ×›×œ ×”××©×™××•×ª â†’</button>
                    </div>
                    <div id="mini-tasks-list" class="space-y-3 text-sm text-slate-500">×˜×•×¢×Ÿ...</div>
                </div>
            </div>
        </div>

        <div id="tab-budget" class="tab-content">
            <div class="bg-white p-6 sticky top-0 z-10 shadow-sm">
                <h1 class="text-2xl font-bold text-slate-800">ğŸ’° ×ª×§×¦×™×‘</h1>
            </div>

            <div class="p-4 space-y-4">
                <div class="card p-6 bg-gradient-to-br from-slate-900 to-slate-800 text-white">
                    <p class="text-slate-400 text-xs font-bold uppercase mb-2">×ª×§×¦×™×‘ ×›×•×œ×œ</p>
                    <h2 class="text-5xl font-black mb-1 editable" onclick="editBudget()" id="total-budget-display">â‚ª0</h2>
                    <p class="text-xs text-slate-400 mb-4">×œ×—×¦×• ×œ×¢×¨×™×›×”</p>
                    <div class="flex items-center gap-2">
                        <div class="flex-1">
                            <p class="text-xs text-slate-400">×”×•×¦××•×ª</p>
                            <p class="text-xl font-bold" id="total-spent-display">â‚ª0</p>
                        </div>
                        <div class="flex-1 text-left">
                            <p class="text-xs text-slate-400">× ×©××¨</p>
                            <p class="text-xl font-bold text-green-400" id="total-remaining-display">â‚ª0</p>
                        </div>
                    </div>
                </div>

                <div id="categories-list" class="space-y-3"></div>
            </div>
        </div>

        <div id="tab-suppliers" class="tab-content">
            <div class="bg-white p-6 sticky top-0 z-10 shadow-sm">
                <h1 class="text-2xl font-bold text-slate-800">ğŸ” ×¡×¤×§×™×</h1>
            </div>

            <div class="p-4 space-y-4">
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-slate-800">ğŸ’¼ ×”×¡×¤×§×™× ×©×œ×™</h3>
                        <button onclick="addVendorModal()" class="text-indigo-600 text-sm font-bold">+ ×”×•×¡×£</button>
                    </div>
                    <div id="my-vendors-list" class="space-y-3">×˜×•×¢×Ÿ ×¡×¤×§×™×...</div>
                </div>
            </div>
        </div>

        <div id="tab-tasks" class="tab-content">
            <div class="bg-white p-6 sticky top-0 z-10 shadow-sm flex justify-between items-center">
                <h1 class="text-2xl font-bold text-slate-800">ğŸ“‹ ××©×™××•×ª</h1>
                <button onclick="addTaskModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm font-bold">+ ×—×“×©</button>
            </div>

            <div class="p-4 space-y-4">
                <div id="tasks-list" class="space-y-3">×˜×•×¢×Ÿ ××©×™××•×ª...</div>
            </div>
        </div>

        <div id="tab-profile" class="tab-content">
            <div class="bg-white p-6 sticky top-0 z-10 shadow-sm">
                <h1 class="text-2xl font-bold text-slate-800">ğŸ‘¤ ×¤×¨×•×¤×™×œ</h1>
            </div>
            <div class="p-4">
                <div class="card p-6">
                    <p class="text-center text-slate-500">×’×¨×¡×ª ×“××• ××—×•×‘×¨×ª ×œ×¢× ×Ÿ</p>
                    <p class="text-center font-bold mt-2" id="version-display">V2.0 Connected</p>
                </div>
            </div>
        </div>

    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 px-4 py-3 flex justify-around items-center shadow-2xl z-50">
        <button onclick="switchTab('home')" id="nav-home" class="nav-item active flex flex-col items-center">
            <span class="text-2xl">ğŸ </span>
            <span class="text-[10px] font-bold mt-1 text-indigo-600">×‘×™×ª</span>
        </button>
        <button onclick="switchTab('budget')" id="nav-budget" class="nav-item flex flex-col items-center">
            <span class="text-2xl">ğŸ’°</span>
            <span class="text-[10px] font-bold mt-1 text-slate-400">×ª×§×¦×™×‘</span>
        </button>
        <button onclick="switchTab('suppliers')" id="nav-suppliers" class="nav-item flex flex-col items-center">
            <span class="text-2xl">ğŸ”</span>
            <span class="text-[10px] font-bold mt-1 text-slate-400">×¡×¤×§×™×</span>
        </button>
        <button onclick="switchTab('tasks')" id="nav-tasks" class="nav-item flex flex-col items-center">
            <span class="text-2xl">ğŸ“‹</span>
            <span class="text-[10px] font-bold mt-1 text-slate-400">××©×™××•×ª</span>
        </button>
        <button onclick="switchTab('profile')" id="nav-profile" class="nav-item flex flex-col items-center">
            <span class="text-2xl">ğŸ‘¤</span>
            <span class="text-[10px] font-bold mt-1 text-slate-400">×¤×¨×•×¤×™×œ</span>
        </button>
    </div>

    <script>
        // CONFIG
        const API_URL = "https://my-project-n3th.onrender.com";
        const WEDDING_ID = "demo-wedding-1"; // ×§×‘×•×¢ ×›×“×™ ×œ×”×‘×˜×™×— ×—×™×‘×•×¨

        // STATE
        let appState = {
            budget: 0,
            spent: 0
        };

        // --- CORE FUNCTIONS ---

        async function initApp() {
            showToast('××ª×—×‘×¨ ×œ×©×¨×ª...', 'â˜ï¸');
            await loadDashboard();
        }

        async function loadDashboard() {
            try {
                const res = await fetch(`${API_URL}/weddings/${WEDDING_ID}/dashboard`);
                if (!res.ok) throw new Error("Failed to load");
                const data = await res.json();

                // ×¢×“×›×•×Ÿ UI ×¨××©×™
                document.getElementById('display-names').textContent = `${data.bride_name} ×•${data.groom_name}`;
                document.getElementById('days-left').textContent = data.days_left;
                document.getElementById('display-date').textContent = `ğŸ“… ${data.date}`;
                
                // ×¢×“×›×•×Ÿ ××•× ×™×
                document.getElementById('tasks-done-count').textContent = data.tasks_done;
                document.getElementById('tasks-urgent-count').textContent = data.tasks_urgent;
                document.getElementById('budget-spent-display').textContent = `â‚ª${data.total_spent.toLocaleString()}`;

                // ×¢×“×›×•×Ÿ State ×œ×ª×§×¦×™×‘
                appState.budget = data.total_budget;
                appState.spent = data.total_spent;
                
                // ×¢×“×›×•×Ÿ ××™× ×™-××©×™××•×ª
                loadMiniTasks();
                
            } catch (e) {
                console.error(e);
                showToast("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª (× ×¡×” ×œ×¨×¢× ×Ÿ)", "âŒ");
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // ×¢×“×›×•×Ÿ ×¦×‘×¢×™× ×‘×ª×¤×¨×™×˜
            document.querySelectorAll('.nav-item span:last-child').forEach(el => el.className = 'text-[10px] font-bold mt-1 text-slate-400');
            document.querySelector(`#nav-${tabName} span:last-child`).className = 'text-[10px] font-bold mt-1 text-indigo-600';

            // ×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×¤×™ ×˜××‘
            if (tabName === 'budget') loadBudgetScreen();
            if (tabName === 'tasks') loadTasksScreen();
            if (tabName === 'suppliers') loadVendorsScreen();
            if (tabName === 'home') loadDashboard();
        }

        // --- BUDGET LOGIC ---

        async function loadBudgetScreen() {
            document.getElementById('total-budget-display').textContent = `â‚ª${appState.budget.toLocaleString()}`;
            document.getElementById('total-spent-display').textContent = `â‚ª${appState.spent.toLocaleString()}`;
            document.getElementById('total-remaining-display').textContent = `â‚ª${(appState.budget - appState.spent).toLocaleString()}`;

            try {
                const res = await fetch(`${API_URL}/weddings/${WEDDING_ID}/categories`);
                const categories = await res.json();
                
                const html = categories.map(cat => `
                    <div class="card p-5">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">${cat.icon}</span>
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <h4 class="font-bold text-slate-800">${cat.name}</h4>
                                    <span class="font-bold text-slate-600">â‚ª${cat.planned_amount.toLocaleString()}</span>
                                </div>
                                <div class="w-full bg-slate-100 rounded-full h-2 mt-2">
                                    <div class="bg-indigo-500 h-2 rounded-full" style="width: ${Math.min((cat.actual_amount / cat.planned_amount)*100, 100)}%"></div>
                                </div>
                                <p class="text-xs text-slate-500 mt-1">× ×•×¦×œ: â‚ª${cat.actual_amount.toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('categories-list').innerHTML = html;
            } catch (e) {
                document.getElementById('categories-list').innerHTML = "×©×’×™××” ×‘×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª";
            }
        }

        function editBudget() {
            showModal('×¢×“×›×•×Ÿ ×ª×§×¦×™×‘', `
                <input type="number" id="new-budget-input" value="${appState.budget}" class="w-full p-3 border rounded-xl mb-3">
                <button onclick="saveBudget()" class="w-full btn-primary text-white py-3 rounded-xl font-bold">×©××•×¨</button>
            `);
        }

        async function saveBudget() {
            const val = document.getElementById('new-budget-input').value;
            try {
                await fetch(`${API_URL}/weddings/${WEDDING_ID}/budget`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({total: Number(val)})
                });
                appState.budget = Number(val);
                closeModal();
                showToast('×ª×§×¦×™×‘ ×¢×•×“×›×Ÿ');
                loadBudgetScreen();
            } catch (e) {
                showToast('×©×’×™××”', 'âŒ');
            }
        }

        // --- TASKS LOGIC ---

        async function loadTasksScreen() {
            try {
                const res = await fetch(`${API_URL}/weddings/${WEDDING_ID}/tasks`);
                const tasks = await res.json();
                
                const html = tasks.map(task => `
                    <div class="card p-4 flex items-center gap-3">
                        <input type="checkbox" ${task.is_completed ? 'checked' : ''} 
                            onchange="toggleTask('${task.id}')"
                            class="w-6 h-6 accent-indigo-600">
                        <div class="flex-1">
                            <p class="font-bold ${task.is_completed ? 'line-through text-slate-400' : 'text-slate-800'}">${task.title}</p>
                            ${task.is_urgent ? '<span class="text-xs text-orange-500 font-bold">âš ï¸ ×“×—×•×£</span>' : ''}
                        </div>
                        <button onclick="deleteTask('${task.id}')" class="text-red-400 p-2">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
                document.getElementById('tasks-list').innerHTML = html || '<p class="text-center text-slate-400">××™×Ÿ ××©×™××•×ª</p>';
            } catch (e) {
                document.getElementById('tasks-list').innerHTML = "×©×’×™××” ×‘×˜×¢×™× ×”";
            }
        }

        async function loadMiniTasks() {
            try {
                const res = await fetch(`${API_URL}/weddings/${WEDDING_ID}/tasks`);
                const tasks = await res.json();
                const pending = tasks.filter(t => !t.is_completed).slice(0, 3);
                
                const html = pending.map(t => `
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full ${t.is_urgent ? 'bg-orange-500' : 'bg-indigo-500'}"></div>
                        <span>${t.title}</span>
                    </div>
                `).join('');
                document.getElementById('mini-tasks-list').innerHTML = html || '××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª ğŸ‰';
            } catch(e) {}
        }

        function addTaskModal() {
            showModal('××©×™××” ×—×“×©×”', `
                <input type="text" id="task-title-input" placeholder="××” ×¦×¨×™×š ×œ×¢×©×•×ª?" class="w-full p-3 border rounded-xl mb-3">
                <label class="flex items-center gap-2 mb-4">
                    <input type="checkbox" id="task-urgent-input" class="w-5 h-5">
                    <span>×“×—×•×£?</span>
                </label>
                <button onclick="saveTask()" class="w-full btn-primary text-white py-3 rounded-xl font-bold">×”×•×¡×£</button>
            `);
        }

        async function saveTask() {
            const title = document.getElementById('task-title-input').value;
            const urgent = document.getElementById('task-urgent-input').checked;
            
            if(!title) return;

            try {
                await fetch(`${API_URL}/weddings/${WEDDING_ID}/tasks`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({title, is_urgent: urgent})
                });
                closeModal();
                showToast('××©×™××” × ×•×¡×¤×”');
                loadTasksScreen();
            } catch (e) { showToast('×©×’×™××”', 'âŒ'); }
        }

        async function toggleTask(id) {
            await fetch(`${API_URL}/tasks/${id}/toggle`, {method: 'PUT'});
            loadTasksScreen(); // ×¨×¢× ×•×Ÿ ×›×“×™ ×œ×¨××•×ª ××ª ×”×§×• ×”×—×•×¦×”
        }

        async function deleteTask(id) {
            if(!confirm('×œ××—×•×§?')) return;
            await fetch(`${API_URL}/tasks/${id}`, {method: 'DELETE'});
            loadTasksScreen();
        }

        // --- VENDORS LOGIC ---

        async function loadVendorsScreen() {
            try {
                const res = await fetch(`${API_URL}/weddings/${WEDDING_ID}/vendors`);
                const vendors = await res.json();
                
                const html = vendors.map(v => `
                    <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl">
                        <div>
                            <p class="font-bold">${v.name}</p>
                            <p class="text-xs text-slate-500">${v.category} â€¢ â‚ª${v.amount.toLocaleString()}</p>
                        </div>
                        <button onclick="deleteVendor('${v.id}')" class="text-red-400">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
                document.getElementById('my-vendors-list').innerHTML = html || '×˜×¨× × ×•×¡×¤×• ×¡×¤×§×™×';
            } catch (e) {}
        }

        function addVendorModal() {
            showModal('×”×•×¡×£ ×¡×¤×§', `
                <select id="v-cat" class="w-full p-3 border rounded-xl mb-3">
                    <option value="××•×œ× ×•××™×¨×•×—">××•×œ× ×•××™×¨×•×—</option>
                    <option value="×¦×™×œ×•× ×•×•×™×“××•">×¦×™×œ×•× ×•×•×™×“××•</option>
                    <option value="××•×–×™×§×” ×•×‘×™×“×•×¨">××•×–×™×§×” ×•×‘×™×“×•×¨</option>
                    <option value="××—×¨">××—×¨</option>
                </select>
                <input type="text" id="v-name" placeholder="×©× ×”×¢×¡×§" class="w-full p-3 border rounded-xl mb-3">
                <input type="number" id="v-amount" placeholder="×¡×›×•×" class="w-full p-3 border rounded-xl mb-3">
                <button onclick="saveVendor()" class="w-full btn-primary text-white py-3 rounded-xl font-bold">×©××•×¨</button>
            `);
        }

        async function saveVendor() {
            const cat = document.getElementById('v-cat').value;
            const name = document.getElementById('v-name').value;
            const amount = document.getElementById('v-amount').value;
            
            if(!name || !amount) return;

            try {
                await fetch(`${API_URL}/weddings/${WEDDING_ID}/vendors`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name, category: cat, amount: Number(amount)})
                });
                closeModal();
                showToast('×¡×¤×§ × ×•×¡×£');
                loadVendorsScreen();
            } catch (e) { showToast('×©×’×™××”', 'âŒ'); }
        }

        async function deleteVendor(id) {
            if(!confirm('×œ××—×•×§ ×¡×¤×§ ×–×”?')) return;
            await fetch(`${API_URL}/vendors/${id}`, {method: 'DELETE'});
            loadVendorsScreen();
        }

        // UTILS
        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('modal').classList.add('show');
        }
        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }
        function showToast(msg, icon='âœ…') {
            const t = document.getElementById('toast');
            document.getElementById('toast-message').textContent = msg;
            document.getElementById('toast-icon').textContent = icon;
            t.classList.add('show');
            setTimeout(()=>t.classList.remove('show'), 3000);
        }

        // START
        document.addEventListener('DOMContentLoaded', initApp);

    </script>
</body>
</html>